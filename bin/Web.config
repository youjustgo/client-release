<?xml version="1.0" encoding="utf-8"?>
<!--
  !!! Add the sections bellow to the web.config file of the application 
  !!! this HttpModule is used with.
  -->
<configuration>
  <appSettings>
    <add key="YouJustGo.Jwt.Subject" value="http://youjustgo.com/client"/>
    <add key="YouJustGo.Jwt.Issuer" value="youjustgo.com"/>
    <add key="YouJustGo.Jwt.Audience" value="http://youjustgo.com/api"/>
    <add key="YouJustGo.Jwt.ValidForMinutes" value="1440"/><!--"5256000" - 10 years-->
    <add key="YouJustGo.Jwt.CookieName" value="YouJustGoWebApiToken"/>
    <add key="YouJustGo.Jwt.UseCert" value="False"/>
    <add key="YouJustGo.Jwt.CertSubject" value="dev.webapi.youjustgo.com"/>
    <add key="YouJustGo.Jwt.CertThumbprint" value="D21A827604BD53AFF3C55A9D45218628D7A642BE"/>
    <add key="YouJustGo.Jwt.Secret" value="D21A827604BD53AFF3C55A9D45218628D7A642BE"/>
  </appSettings>
  <system.webServer>
    <!-- http://stackoverflow.com/questions/29373297/azure-website-slow-to-serve-static-js-css-but-not-binary -->
    <serverRuntime enabled="true"  frequentHitThreshold="1"  frequentHitTimePeriod="00:00:20" />
    <staticContent>
        <mimeMap fileExtension=".json" mimeType="application/json" />
        <mimeMap fileExtension="woff" mimeType="application/font-woff" />
        <mimeMap fileExtension="woff2" mimeType="application/font-woff" /> 
        <clientCache cacheControlMode="DisableCache" />
        <!-- DEV and SHADOW are not cached this way, which is good. PROD is cached via Cloudflare -->
    </staticContent>
    <defaultDocument enabled="true">
      <files>
        <clear/>
        <add value="index.aspx" />
        <add value="index.html" />
        <add value="index.htm" />
      </files>
    </defaultDocument>
    <httpProtocol>
      <customHeaders>
        <remove name="X-Powered-By" />
      </customHeaders>
    </httpProtocol>
    <rewrite>
      <rules>
       <clear/>
        <rule name="HTTP/S to HTTPS Redirect expect youjustgo.com" enabled="true" stopProcessing="true">
          <match url="(.*)" />
          <conditions>
             <add input="{HTTPS}" pattern="off" ignoreCase="true" />
            <add input="{HTTP_HOST}" negate="true" pattern="^youjustgo\.com$" />
          </conditions>
          <action type="Redirect" url="https://{HTTP_HOST}{REQUEST_URI}" redirectType="Permanent" appendQueryString="false" />
        </rule>
        <rule name="redirect en requests" stopProcessing="true">
            <match url="^(en\/.*)$" ignoreCase="true"/>
            <conditions logicalGrouping="MatchAll">
                <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" pattern="" ignoreCase="false"/>
            </conditions>
            <action type="Rewrite" url="en/index.aspx" appendQueryString="true"/>
        </rule>
        <rule name="redirect zh requests" stopProcessing="true">
            <match url="^(zh\/.*)$" ignoreCase="true"/>
            <conditions logicalGrouping="MatchAll">
                <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" pattern="" ignoreCase="false"/>
            </conditions>
            <action type="Rewrite" url="zh/index.aspx" appendQueryString="true"/>
        </rule>
        
      </rules>
    </rewrite>
    <modules runAllManagedModulesForAllRequests="true">
      <add name="JwtIssuerHttpModule" preCondition="integratedMode" type="YouJustGo.Client.Security.Jwt.JwtIssuerHttpModule, YouJustGo.Client.Security"/>
    </modules>
    
    <urlCompression doStaticCompression="true" doDynamicCompression="true" />
    <httpCompression>
      <dynamicTypes>
        <clear/>
        <add enabled="true" mimeType="text/*"/>
        <add enabled="true" mimeType="message/*"/>
        <add enabled="true" mimeType="application/x-javascript"/>
        <add enabled="true" mimeType="application/javascript"/>
        <add enabled="true" mimeType="application/json"/>
        <add enabled="false" mimeType="*/*"/>
        <add enabled="true" mimeType="application/atom+xml"/>
        <add enabled="true" mimeType="application/atom+xml;charset=utf-8"/>
      </dynamicTypes>
      <staticTypes>
        <clear/>
        <add enabled="true" mimeType="text/*"/>
        <add enabled="true" mimeType="message/*"/>
        <add enabled="true" mimeType="application/javascript"/>
        <add enabled="true" mimeType="application/atom+xml"/>
        <add enabled="true" mimeType="application/xaml+xml"/>
        <add enabled="true" mimeType="application/json"/>
        <add enabled="false" mimeType="*/*"/>
      </staticTypes>
    </httpCompression>
    
  </system.webServer>
</configuration>
